name: Xiaomi R4A Build (Auto)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ§¹ æ¸…ç†ç©ºé—´
      run: |
        sudo rm -rf /opt/*
        df -h

    - name: ğŸ“¥ å…‹éš†å½“å‰ä»“åº“
      uses: actions/checkout@v3

    - name: ğŸ“¦ è·å– OpenWrt æºç 
      run: |
        git clone --depth=1 https://github.com/openwrt/openwrt openwrt
        cd openwrt
        ./scripts/feeds update -a
        ./scripts/feeds install -a

    - name: âš™ï¸ æ›¿æ¢é…ç½®æ–‡ä»¶
      run: |
        cp .config openwrt/.config

    - name: ğŸ› ï¸ ç¼–è¯‘å›ºä»¶
      run: |
        cd openwrt
        make defconfig
        make -j$(nproc) download
        make -j$(nproc)

    - name: ğŸ“¦ æ‰“åŒ…å›ºä»¶ä¸º ZIP
      run: |
        cd openwrt/bin/targets/
        zip -r firmware.zip ./

    - name: ğŸš€ å‘å¸ƒåˆ° GitHub Releases
      uses: softprops/action-gh-release@v1
      with:
        tag_name: auto-${{ github.run_number }}
        name: Xiaomi R4A Firmware Build #${{ github.run_number }}
        body: |
          è‡ªåŠ¨ç¼–è¯‘çš„å°ç±³ 4A åƒå…†ç‰ˆå›ºä»¶ã€‚
          é…ç½®æ–‡ä»¶ï¼š.config
          æ„å»ºç¼–å·ï¼š${{ github.run_number }}
      files: |
        openwrt/bin/targets/firmware.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
name: Xiaomi R4A Build (Auto)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ§¹ æ¸…ç†ç©ºé—´
      run: |
        sudo rm -rf /opt/*
        df -h

    - name: ğŸ“¥ å…‹éš†å½“å‰ä»“åº“
      uses: actions/checkout@v3

    - name: ğŸ“¦ è·å– OpenWrt æºç 
      run: |
        git clone --depth=1 https://github.com/openwrt/openwrt openwrt
        cd openwrt
        ./scripts/feeds update -a
        ./scripts/feeds install -a

    - name: âš™ï¸ æ›¿æ¢é…ç½®æ–‡ä»¶
      run: |
        cp .config openwrt/.config

    - name: ğŸ› ï¸ ç¼–è¯‘å›ºä»¶
      run: |
        cd openwrt
        make defconfig
        make -j$(nproc) download
        make -j$(nproc)

    - name: ğŸ“¦ æ‰“åŒ…å›ºä»¶ä¸º ZIP
      run: |
        cd openwrt/bin/targets/
        zip -r firmware.zip ./

    - name: ğŸš€ å‘å¸ƒåˆ° GitHub Releases
      uses: softprops/action-gh-release@v1
      with:
        tag_name: auto-${{ github.run_number }}
        name: Xiaomi R4A Firmware Build #${{ github.run_number }}
        body: |
          è‡ªåŠ¨ç¼–è¯‘çš„å°ç±³ 4A åƒå…†ç‰ˆå›ºä»¶ã€‚
          é…ç½®æ–‡ä»¶ï¼š.config
          æ„å»ºç¼–å·ï¼š${{ github.run_number }}
      files: |
        openwrt/bin/targets/firmware.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
